{{- $backup_namespace := "" -}}
{{- if (hasKey . "backup_namespace") -}}
{{-   $backup_namespace = .backup_namespace -}}
{{- else -}}
{{-   $backup_namespace = promptString "Backup namespace" -}}
{{- end -}}

{{- $password_salt := default ((bitwarden "item" "backup-env.yml").notes | fromYaml).PASSWORD_SALT .password_salt -}}

[data]
    backup_namespace = {{ $backup_namespace | quote }}
    signing_key_id = "A88CE79A6BAC53C39AC331099025163398B61D7E"

[data.env]
    restic_password = {{ sha256sum (print $backup_namespace $password_salt) | quote }}
    b2_account_id = {{ default ((bitwarden "item" "backup-env.yml").notes | fromYaml).B2_ACCOUNT_ID .env.b2_account_id | quote }}
    b2_account_key = {{ default ((bitwarden "item" "backup-env.yml").notes | fromYaml).B2_ACCOUNT_KEY .env.b2_account_key | quote }}

[diff]
    command = "delta"
    args = {{`["{{ .Destination }}", "{{ .Target }}"]`}}
