{{- $backup_namespace := "" -}}
{{- if (hasKey . "backup_namespace") -}}
{{-   $backup_namespace = .backup_namespace -}}
{{- else -}}
{{-   $backup_namespace = promptString "Backup namespace" -}}
{{- end -}}

{{- $backup_env := (bitwarden "item" "chezmoi-env.yml").notes | fromYaml -}}
{{- $password_salt := default $backup_env.PASSWORD_SALT .password_salt -}}

[data]
    backup_bucket = "grader-rectify-patio"
    backup_namespace = {{ $backup_namespace | quote }}
    nextdns_profile = "1d7724"
    signing_key_id = "A88CE79A6BAC53C39AC331099025163398B61D7E"
    {{ if (eq .chezmoi.os "darwin") }}
    brew_cmd = "/usr/local/bin/brew"
    {{ else if (eq .chezmoi.os "linux" ) }}
    brew_cmd = "/home/linuxbrew/.linuxbrew/bin/brew"
    {{ end }}

[data.env]
    restic_password = {{ sha256sum (print $backup_namespace $password_salt) | quote }}
    b2_account_id = {{ default $backup_env.B2_ACCOUNT_ID .env.b2_account_id | quote }}
    b2_account_key = {{ default $backup_env.B2_ACCOUNT_KEY .env.b2_account_key | quote }}

[diff]
    command = "delta"
    args = {{`["{{ .Destination }}", "{{ .Target }}"]`}}
